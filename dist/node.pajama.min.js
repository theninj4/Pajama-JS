document={};var elemCount=0;document.createElement=function(e){var t=[];var n=[];var r={};var i={tagName:e,elemCount:elemCount++,classList:{add:function(e){n.push(e)},remove:function(e){for(var t=0;t<n.length;t++){if(n[t]==e){n.splice(t,1)}}},contains:function(e){for(var t=0;t<n.length;t++){if(n[t]==e){return true}}return false}},addEventListener:function(e,t){if(!r[e])r[e]=[];r[e].push(t)},removeEventListener:function(e,t){if(!r[e])return;var n=r[e].indexOf(t);if(n>=0){r[e].splice(n,1)}},appendChild:function(e){t.push(e);e.parentNode=i;this.firstChild=t[0]},insertBefore:function(e,n){var r=t.indexOf(n);e.parentNode=this;if(r<0){t.unshift(e);return}t.splice(r,0,e);this.firstChild=t[0]},removeChild:function(e){for(var n=0;n<t.length;n++){if(t[n]==e){t.splice(n,1);e.parentNode=null;break}}this.firstChild=t[0]},childNodes:t,dispatchEvent:function(e){if(r[e.type]){for(var t=0;t<r[e.type].length;t++){r[e.type][t].call({},{})}}if(this.parentNode){this.parentNode.dispatchEvent(e)}},parentNode:null,firstChild:null,setAttribute:function(e,t){this[e]=t}};return i};document.createEvent=function(){return{type:"",initEvent:function(e,t,n){this.type=e}}};var require=require||null;function PjsDataBindingRequest(e){for(var t in e){this[t]=e[t]}}function PjsBindProperty(e,t,n,r){if(!e.hasOwnProperty(t)){e[t]=""}if(e[t]instanceof Function){var i=function(i){e[t].call(e,r.getAttr(n),i)};r.garbage.push(function(){r.removeEvent(n,i)});r.addEvent(n,i);return}if(!Object.getOwnPropertyDescriptor(e,t).hasOwnProperty("get")){var a=e[t];var o=[];var l;Object.defineProperty(e,t,{get:function(){return l.getAttr(n)},set:function(n){if(n instanceof PjsDataBindingRequest){l=n.element;var i=function(){n.element.setAttr(n.attr,a)};var s=function(r){if(n.element.getAttr(n.attr)!=a){e[t]=n.element.getAttr(n.attr)}};r.garbage.push(function(){l=null;var r=o.indexOf(i);if(r>=0){o.splice(r,1)}n.element.removeEvent("change",s);n.element.removeEvent("keyup",s);Object.defineProperty(e,t,{value:a,writable:true})});o.push(i);n.element.addEvent("change",s);n.element.addEvent("keyup",s);n.element.setAttr(n.attr,a)}else{a=n;for(var c=0;c<o.length;c++){o[c].call(r,a)}}},enumerable:true})}e[t]=new PjsDataBindingRequest({element:r,attr:n})}function PjsBindArray(e,t,n,r){if(!e.hasOwnProperty(t)){e[t]=[]}if(!Object.getOwnPropertyDescriptor(e,t).hasOwnProperty("get")){var i=e[t];var a=[];Object.defineProperty(e,t,{get:function(){var n=i.concat([]);Object.defineProperty(n,"pop",{value:function(){var e=i.pop();for(var t=0;t<a.length;t++){var n=a[t].element.getNodes();n[n.length-1].remove()}return e}});Object.defineProperty(n,"push",{value:function(){var e=i.push.apply(i,Array.prototype.slice.call(arguments));for(var t=0;t<a.length;t++){var n=a[t];n.element.append(n.func.call({},arguments[0]))}return e}});Object.defineProperty(n,"reverse",{value:function(){var n=i.reverse();e[t]=i;return n}});Object.defineProperty(n,"shift",{value:function(){var e=i.shift();for(var t=0;t<a.length;t++){var n=a[t].element.getNodes();n[0].remove()}return e}});Object.defineProperty(n,"sort",{value:function(){var n=i.sort.apply(i,Array.prototype.slice.call(arguments));e[t]=i;return n}});Object.defineProperty(n,"splice",{value:function(){var n=i.splice.apply(i,Array.prototype.slice.call(arguments));e[t]=i;return n}});Object.defineProperty(n,"unshift",{value:function(){var e=i.unshift.apply(i,Array.prototype.slice.call(arguments));for(var t=0;t<a.length;t++){var n=a[t];n.element.prepend(n.func.call({},arguments[0]))}return e}});return n},set:function(n){if(n instanceof PjsDataBindingRequest){a.push({element:n.element,func:n.func})}else{i=n}for(var r=0;r<a.length;r++){var o=a[r];o.element.clear();for(var l in i){o.element.append(o.func.call({},e[t][l]))}}},enumerable:true})}e[t]=new PjsDataBindingRequest({element:n,func:r})}var elemCount=0;function PjsElement(e){if(!e)e={};if(!e.tag)e.tag="div";var t=document.createElement(e.tag);var n=this;n.dom=t;n.eventList=[];n.garbage=[];t._view=n;n.uuid=elemCount++;n.prepend=function(e){var t=e;if(!(t instanceof Array))t=Array.prototype.slice.call(arguments);for(var r=0;r<t.length;r++){var i=t[r];if(i instanceof PjsElement){n.dom.insertBefore(i.dom,n.dom.firstChild);if(require)n.fireEvent("PjsChange",{type:"prepend",parent:n.uuid,markup:i.toMarkup(true)})}else{n.prepend(new PjsElement(i))}}};n.append=function(e){var t=e;if(!(t instanceof Array))t=Array.prototype.slice.call(arguments);for(var r=0;r<t.length;r++){var i=t[r];if(i instanceof PjsElement){n.dom.appendChild(i.dom);if(require)n.fireEvent("PjsChange",{type:"append",parent:n.uuid,markup:i.toMarkup(true)})}else{n.append(new PjsElement(i))}}};n.remove=function(e){if(require&&!e){n.fireEvent("PjsChange",{type:"remove",parent:n.dom.parentNode._view.uuid,child:n.uuid})}n.dom.parentNode.removeChild(n.dom);n.recycle()};n.recycle=function(){var e=n.getNodes();for(var t=0;t<e.length;t++){e[t].recycle()}for(var t=0;t<n.garbage.length;t++){n.garbage[t]()}};n.addClass=function(e){if(e!=""){n.dom.className=n.dom.className||"";n.dom.className+=" "+e}};n.removeClass=function(e){if(e!=""){n.dom.className=(" "+n.dom.className+" ").replace(" "+e+" ","")}};n.hasClass=function(e){return(" "+n.dom.className+" ").indexOf(" "+e+" ")!=-1};n.setAttr=function(e,t){if(typeof e=="string"&&n.dom[e]!=t){n.dom[e]=t;n.dom.setAttribute(e,t);if(require)n.fireEvent("PjsChange",{type:"attr",id:n.uuid,attr:e,value:t})}};n.getAttr=function(e){return n.dom[e]};n.addEvent=function(e,t){n.dom.addEventListener(e,t);if(n.eventList.indexOf(e)==-1)n.eventList.push(e)};n.removeEvent=function(e,t){n.dom.removeEventListener(e,t)};n.setValue=function(e){if(["input","select"].indexOf(n.dom.tagName.toLowerCase())!=-1){n.dom.value=e}else{n.dom.innerHTML=e}};n.getValue=function(){return n.dom.value||n.dom.innerHTML};n.clear=function(){var e=n.dom.childNodes.length;for(var t=0;t<e;t++){n.dom.childNodes[0]._view.remove(true)}if(require)n.fireEvent("PjsChange",{type:"clear",parent:n.uuid});return n};n.fireEvent=function(e,t){var r=document.createEvent("HTMLEvents");r.initEvent(e,true,true);r.detail=t;n.dom.dispatchEvent(r);return n};n.getNodes=function(){var e=[];for(var t=0;t<n.dom.childNodes.length;t++){var r=n.dom.childNodes[t];if(r._view){e.push(r._view)}else{var i=new PjsElement;i.dom=r;e.push(i)}}return e};n.getByUuid=function(e){if(n.uuid==e)return n;for(var t=0;t<n.dom.childNodes.length;t++){var r=n.dom.childNodes[t]._view.getByUuid(e);if(r)return r}return null};n.toMarkup=function(e){var t="<"+n.dom.tagName;for(var r in n.dom){if(["tagName","elemCount","classList","addEventListener","appendChild","removeChild","childNodes","dispatchEvent","_view","parentNode"].indexOf(r)<0){if(typeof n.dom[r]=="string"||typeof n.dom[r]=="number"){t+=" "+r+'="'+n.dom[r]+'"'}}}if(e){t+=" id='"+n.uuid+"'";for(var i in n.eventList){var a=n.eventList[i];t+=" on"+a+"=\"dispatch('"+n.uuid+"', '"+a+"', event)\" "}}t+=">";if(n.dom.innerHTML){t+=n.dom.innerHTML}for(var o in n.dom.childNodes){t+=n.dom.childNodes[o]._view.toMarkup(e)}return t+"</"+n.dom.tagName+">"};if(e.classes){for(var r=0;r<e.classes.length;r++){n.addClass(e.classes[r])}}if(e.contains){var i=e.contains;if(i instanceof Object&&Object.keys(i).length==1&&e.forEach){var a=Object.keys(i)[0];PjsBindArray(i[a],a,n,e.forEach)}else{if(!(i instanceof Array))i=[i];for(var r=0;r<i.length;r++){n.append(i[r])}}}for(var r in e){if(r!="classes"&&r!="contains"&&r!="tag"&&r!="forEach"){var o=e[r];if(o instanceof Object){var l=Object.keys(o);for(var s=0;s<l.length;s++){var c=l[s];PjsBindProperty(o[c],c,r,n)}}else{n.setAttr(r,e[r])}}}}var mvc={};var bits=["model","view"];for(var i=0;i<bits.length;i++){!function(e){mvc[e]={__pjsDefine:function(t,n){if(mvc[e].hasOwnProperty(t)){console.log("Duplicate definition found for "+e,t);return}mvc[e][t]=n},__pjsCreate:function(t,n){if(!mvc[e].hasOwnProperty(t)){console.error("Dynamic script loader failed to find "+e+":",t);return null}var n=Array.prototype.slice.call(arguments);n.shift();var r={};if(e=="view")r=new PjsElement({classes:["view."+t]});mvc[e][t].apply(r,n);return r}}}(bits[i])}var bootstrapper=function(){var e=io.connect("http://---");e.on("fullPage",function(e){document.body.innerHTML=e});e.on("updateDom",function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.type=="attr"){var r=document.getElementById(n.id);if(r){r[n.attr]=n.value}}else if(n.type=="append"){var i=document.createElement("div");i.innerHTML=n.markup;var r=document.getElementById(n.parent);if(r){r.appendChild(i.firstChild)}}else if(n.type=="prepend"){var i=document.createElement("div");i.innerHTML=n.markup;var r=document.getElementById(n.parent);if(r){r.insertBefore(i.firstChild,r.firstChild)}}else if(n.type=="remove"){var a=document.getElementById(n.parent);var o=document.getElementById(n.child);if(a){a.removeChild(o)}}else if(n.type=="clear"){var a=document.getElementById(n.parent);if(a){a.innerHTML=""}}}});e.on("loading",function(){document.body.innerHTML=""});e.emit("pageLoad",window.location.pathname+window.location.search);function t(t,n,r){var i={};for(var a in r){if(typeof r[a]=="string"||typeof r[a]=="number"){i[a]=r[a]}}e.emit("action",{id:t,type:n,value:r.srcElement.value,content:r.srcElement.innerHTML})}};function startServer(e,t){var n=e.host+":"+e.port;console.log("Starting pjs server on",n);for(var r in t){t[r].url=new RegExp("^"+t[r].url.replace(/\//g,"\\/").replace(/\*/g,"([^\\/]{0,})"))}var i=bootstrapper.toString().replace("---",n);i=i.substring(13,i.length-1);var a=require("http").createServer(function(e,t){t.writeHead(200);t.end('<html><head><script src="/socket.io/socket.io.js"></script><script>'+i+"</script></head><body></body></html>")});var o=require("socket.io").listen(a,{log:false});o.set("transports",["websocket","htmlfile","xhr-polling","jsonp-polling"]);o.enable("browser client minification");o.enable("browser client etag");o.enable("browser client gzip");a.listen(e.port);o.sockets.on("connection",function(e){var n=new PjsElement;n.dom=document.createElement("div");var i;var a=[];n.dom.parentNode={dispatchEvent:function(t){if(t.type=="PjsChange"){a.push(t.detail);if(i)clearTimeout(i);i=setTimeout(function(){e.emit("updateDom",a);a=[]},100)}}};e.on("pageLoad",function(i){var a=t[t.length-1].controller;for(r in t){if(i.match(t[r].url)){a=t[r].controller;break}}n.clear();e.emit("fullPage",n.toMarkup(true));var o={headers:e.handshake.headers,address:e.handshake.address,url:i};a.call({},n,o)});e.on("sync",function(){e.emit("fullPage",n.toMarkup(true))});e.on("action",function(e){if(!e||!e.id||!e.type||!(e.value||e.content)){return}var t=n.getByUuid(e.id);if(!t){console.log("--------");console.log("Couldn't perform action:",e);console.log(n.toMarkup(true));return}if(t.tag!="button"){t.setValue(e.value||e.content)}t.fireEvent(e.type)});e.on("disconnect",function(){n.clear();n=null})})}module.exports={defineModel:mvc.model.__pjsDefine,defineView:mvc.view.__pjsDefine,element:PjsElement,model:mvc.model.__pjsCreate,view:mvc.view.__pjsCreate,startServer:startServer};